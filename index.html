<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cari Jodoh Pro</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
</head>
<body class="bg-pink-50 min-h-screen">

<header class="bg-pink-600 text-white p-4 text-center text-2xl font-bold">â¤ï¸ Cari Jodoh Pro</header>

<main class="p-6 max-w-4xl mx-auto space-y-6">

  <!-- AUTH -->
  <div id="auth" class="bg-white p-6 rounded-2xl shadow">
    <h2 class="text-xl font-semibold mb-4">Login / Register</h2>
    <input id="email" type="email" placeholder="Email" class="w-full p-2 border rounded mb-2" />
    <input id="password" type="password" placeholder="Password" class="w-full p-2 border rounded mb-2" />
    <button onclick="register()" class="bg-pink-600 text-white px-4 py-2 rounded w-full mb-2">Register</button>
    <button onclick="login()" class="border px-4 py-2 rounded w-full">Login</button>
  </div>

  <!-- PROFILE -->
  <div id="profile" class="hidden bg-white p-6 rounded-2xl shadow">
    <h2 class="text-xl font-semibold mb-4">Profil Saya</h2>
    <input id="name" placeholder="Nama" class="w-full p-2 border rounded mb-2" />
    <input id="age" type="number" placeholder="Usia" class="w-full p-2 border rounded mb-2" />
    <select id="gender" class="w-full p-2 border rounded mb-2">
      <option>Pria</option>
      <option>Wanita</option>
    </select>
    <input id="interest" placeholder="Minat (musik, traveling, dll)" class="w-full p-2 border rounded mb-2" />
    <input id="photo" type="file" class="w-full mb-2" />
    <button onclick="saveProfile()" class="bg-pink-600 text-white px-4 py-2 rounded w-full">Simpan Profil</button>
  </div>

  <!-- MATCHING -->
  <div id="matches" class="hidden bg-white p-6 rounded-2xl shadow">
    <h2 class="text-xl font-semibold mb-4">ğŸ’– Hasil Matching</h2>
    <div id="matchList" class="space-y-3"></div>
  </div>

</main>

<script>
  // FIREBASE CONFIG (GANTI DENGAN PUNYAMU)
  const firebaseConfig = {
    apiKey: "API_KEY",
    authDomain: "PROJECT.firebaseapp.com",
    projectId: "PROJECT",
    storageBucket: "PROJECT.appspot.com",
    messagingSenderId: "ID",
    appId: "APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  const storage = firebase.storage();

  function register() {
    auth.createUserWithEmailAndPassword(email.value, password.value)
      .then(() => alert('Register berhasil'))
      .catch(err => alert(err.message));
  }

  function login() {
    auth.signInWithEmailAndPassword(email.value, password.value)
      .catch(err => alert(err.message));
  }

  auth.onAuthStateChanged(user => {
    if (user) {
      authDiv.style.display = 'none';
      profile.style.display = 'block';
      matches.style.display = 'block';
      loadMatches();
    }
  });

  async function saveProfile() {
    const file = photo.files[0];
    const ref = storage.ref('photos/' + auth.currentUser.uid);
    await ref.put(file);
    const photoURL = await ref.getDownloadURL();

    await db.collection('users').doc(auth.currentUser.uid).set({
      name: name.value,
      age: Number(age.value),
      gender: gender.value,
      interest: interest.value,
      photoURL
    });

    alert('Profil disimpan');
  }

  async function loadMatches() {
    const me = await db.collection('users').doc(auth.currentUser.uid).get();
    const data = me.data();

    const users = await db.collection('users').get();
    matchList.innerHTML = '';

    users.forEach(doc => {
      if (doc.id !== auth.currentUser.uid) {
        const u = doc.data();
        if (u.gender !== data.gender && Math.abs(u.age - data.age) <= 5) {
          matchList.innerHTML += `
            <div class="border p-3 rounded">
              <img src="${u.photoURL}" class="w-20 h-20 rounded-full mb-2" />
              <strong>${u.name}</strong> (${u.age})<br>
              <span class="text-sm">${u.interest}</span>
              <button class="block mt-2 text-pink-600">ğŸ’¬ Chat</button>
            </div>`;
        }
      }
    });
  }
</script>

<footer class="text-center p-4 text-sm text-gray-500">Â© 2026 Cari Jodoh Pro</footer>
</body>
</html>
